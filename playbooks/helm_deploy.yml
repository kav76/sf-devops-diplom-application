---
- name: Apply Helm Chart
  hosts: master
  gather_facts: true
  become: true
  tasks:
    - name: Make Helm directory
      ansible.builtin.file:
        path: '/tmp/helm'
        state: directory
        mode: '0755'

    - name: Copy Helm chart to Kubernetes Master Node
      ansible.builtin.copy:
        src: '{{ workspace }}/playbooks/'
        dest: '/tmp/helm/'
        mode: '0755'

    - name: Execute Helm chart
      ansible.builtin.shell: helm upgrade --install --namespace default --set image.tag="{{ imageTag }}" testapp /tmp/helm/helm/

